<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>Xapian: API Documentation: xapian-core: Xapian::Compactor Class Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head>
<body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.5.9 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="namespaceXapian.html">Xapian</a>::<a class="el" href="classXapian_1_1Compactor.html">Compactor</a>
  </div>
</div>
<div class="contents">
<h1>Xapian::Compactor Class Reference</h1><!-- doxytag: class="Xapian::Compactor" -->Compact a database, or merge and compact several.  
<a href="#_details">More...</a>
<p>

<p>
<a href="classXapian_1_1Compactor-members.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classXapian_1_1Compactor.html#a61179ae14a0241d05a1e04d78af2f6e">set_block_size</a> (size_t block_size)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set the block size to use for tables in the output database.  <a href="#a61179ae14a0241d05a1e04d78af2f6e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classXapian_1_1Compactor.html#e9dfc11596ccdcb45f432065f5e6777f">set_renumber</a> (bool renumber)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set whether to preserve existing document id values.  <a href="#e9dfc11596ccdcb45f432065f5e6777f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classXapian_1_1Compactor.html#c2296e5ff042177ffa3dbe475b5d6031">set_multipass</a> (bool multipass)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set whether to merge postlists in multiple passes.  <a href="#c2296e5ff042177ffa3dbe475b5d6031"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classXapian_1_1Compactor.html#78962dc950472dfd237220cc8c2408bb">set_compaction_level</a> (compaction_level compaction)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set the compaction level.  <a href="#78962dc950472dfd237220cc8c2408bb"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classXapian_1_1Compactor.html#409fcee34cbd2a284b4ae19564de39a2">set_destdir</a> (const std::string &amp;destdir)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set where to write the output.  <a href="#409fcee34cbd2a284b4ae19564de39a2"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classXapian_1_1Compactor.html#cc6b30b8bb89baa73bedaa062c510e84">add_source</a> (const std::string &amp;srcdir)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a source database.  <a href="#cc6b30b8bb89baa73bedaa062c510e84"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="3b8aa178bbe37edaccf5345189d3e170"></a><!-- doxytag: member="Xapian::Compactor::compact" ref="3b8aa178bbe37edaccf5345189d3e170" args="()" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classXapian_1_1Compactor.html#3b8aa178bbe37edaccf5345189d3e170">compact</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Perform the actual compaction/merging operation. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classXapian_1_1Compactor.html#ccf46f29ec8aaa2991ed1babb8716d91">set_status</a> (const std::string &amp;table, const std::string &amp;status)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Update progress.  <a href="#ccf46f29ec8aaa2991ed1babb8716d91"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual std::string&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classXapian_1_1Compactor.html#bcd5be85dd80118a2bd5f429b54addde">resolve_duplicate_metadata</a> (const std::string &amp;key, size_t num_tags, const std::string tags[])</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Resolve multiple user metadata entries with the same key.  <a href="#bcd5be85dd80118a2bd5f429b54addde"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Compact a database, or merge and compact several. <hr><h2>Member Function Documentation</h2>
<a class="anchor" name="cc6b30b8bb89baa73bedaa062c510e84"></a><!-- doxytag: member="Xapian::Compactor::add_source" ref="cc6b30b8bb89baa73bedaa062c510e84" args="(const std::string &amp;srcdir)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Xapian::Compactor::add_source           </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&nbsp;</td>
          <td class="paramname"> <em>srcdir</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Add a source database. 
<p>

</div>
</div><p>
<a class="anchor" name="bcd5be85dd80118a2bd5f429b54addde"></a><!-- doxytag: member="Xapian::Compactor::resolve_duplicate_metadata" ref="bcd5be85dd80118a2bd5f429b54addde" args="(const std::string &amp;key, size_t num_tags, const std::string tags[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual std::string Xapian::Compactor::resolve_duplicate_metadata           </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&nbsp;</td>
          <td class="paramname"> <em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>num_tags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string&nbsp;</td>
          <td class="paramname"> <em>tags</em>[]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Resolve multiple user metadata entries with the same key. 
<p>
When merging, if the same user metadata key is set in more than one input, then this method is called to allow this to be resolving in an appropriate way.<p>
The default implementation just returns tags[0].<p>
For multipass this will currently get called multiple times for the same key if there are duplicates to resolve in each pass, but this may change in the future. 
</div>
</div><p>
<a class="anchor" name="a61179ae14a0241d05a1e04d78af2f6e"></a><!-- doxytag: member="Xapian::Compactor::set_block_size" ref="a61179ae14a0241d05a1e04d78af2f6e" args="(size_t block_size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Xapian::Compactor::set_block_size           </td>
          <td>(</td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>block_size</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Set the block size to use for tables in the output database. 
<p>
Valid block sizes are currently powers of two between 2048 and 65536, with the default being 8192, but the valid sizes and default may change in the future. 
</div>
</div><p>
<a class="anchor" name="78962dc950472dfd237220cc8c2408bb"></a><!-- doxytag: member="Xapian::Compactor::set_compaction_level" ref="78962dc950472dfd237220cc8c2408bb" args="(compaction_level compaction)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Xapian::Compactor::set_compaction_level           </td>
          <td>(</td>
          <td class="paramtype">compaction_level&nbsp;</td>
          <td class="paramname"> <em>compaction</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Set the compaction level. 
<p>
Values are:<ul>
<li>Xapian::Compactor::STANDARD - Don't split items unnecessarily.</li><li>Xapian::Compactor::FULL - Split items whenever it saves space (the default).</li><li>Xapian::Compactor::FULLER - Allow oversize items to save more space.</li></ul>
<p>
FULLER isn't recommended if you ever plan to update the compacted database. 
</div>
</div><p>
<a class="anchor" name="409fcee34cbd2a284b4ae19564de39a2"></a><!-- doxytag: member="Xapian::Compactor::set_destdir" ref="409fcee34cbd2a284b4ae19564de39a2" args="(const std::string &amp;destdir)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Xapian::Compactor::set_destdir           </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&nbsp;</td>
          <td class="paramname"> <em>destdir</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Set where to write the output. 
<p>
This can be the same as an input if that input is a stub database (in which case it will be updated atomically). 
</div>
</div><p>
<a class="anchor" name="c2296e5ff042177ffa3dbe475b5d6031"></a><!-- doxytag: member="Xapian::Compactor::set_multipass" ref="c2296e5ff042177ffa3dbe475b5d6031" args="(bool multipass)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Xapian::Compactor::set_multipass           </td>
          <td>(</td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>multipass</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Set whether to merge postlists in multiple passes. 
<p>
Default is false. If set to true and merging more than 3 databases, merge the postlists in multiple passes, which is generally faster but requires more disk space for temporary files. 
</div>
</div><p>
<a class="anchor" name="e9dfc11596ccdcb45f432065f5e6777f"></a><!-- doxytag: member="Xapian::Compactor::set_renumber" ref="e9dfc11596ccdcb45f432065f5e6777f" args="(bool renumber)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Xapian::Compactor::set_renumber           </td>
          <td>(</td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>renumber</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Set whether to preserve existing document id values. 
<p>
The default is true, which means that document ids will be renumbered - currently by applying the same offset to all the document ids in a particular source database.<p>
If false, then the document ids must be unique over all source databases. Currently the ranges of document ids in each source must not overlap either, though this restriction may be removed in the future. 
</div>
</div><p>
<a class="anchor" name="ccf46f29ec8aaa2991ed1babb8716d91"></a><!-- doxytag: member="Xapian::Compactor::set_status" ref="ccf46f29ec8aaa2991ed1babb8716d91" args="(const std::string &amp;table, const std::string &amp;status)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual void Xapian::Compactor::set_status           </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&nbsp;</td>
          <td class="paramname"> <em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&nbsp;</td>
          <td class="paramname"> <em>status</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Update progress. 
<p>
Subclass this method if you want to get progress updates during compaction. This is called for each table first with empty status, And then one or more times with non-empty status.<p>
The default implementation does nothing. 
</div>
</div><p>
<hr>The documentation for this class was generated from the following file:<ul>
<li>xapian/<a class="el" href="compactor_8h.html">compactor.h</a></ul>
</div>
<hr>
<address><small>
Documentation for Xapian (version 1.2.6).<br>
Generated on 13 Jun 2011 by
<a href="http://www.doxygen.org/">Doxygen 1.5.9</a>.
</small></address>
</body>
</html>
