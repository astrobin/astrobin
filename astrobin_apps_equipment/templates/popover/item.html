{% load i18n %}
{% load astrobin_apps_premium_tags %}
{% load astrobin_apps_equipment_tags %}
{% load common_tags %}
{% load toggleproperty_tags %}

<div class="equipment-item-popover">
    <div class="header">
        <h3>{{ item }}</h3>
        <p>{{ item.item_type_label }}</p>
    </div>

    {% if item.properties %}
        <div class="data">
            {% for property in item.properties %}
                <p>
                    <strong>{{ property.label }}</strong>: {{ property.value }}
                </p>
            {% empty %}
                <p>
                    {% trans "No additional information available for this item." %}
                </p>
            {% endfor %}
        </div>
    {% endif %}

    {% with item_listings=item|equipment_item_listings:REQUEST_COUNTRY brand_listings=item|equipment_brand_listings_by_item:REQUEST_COUNTRY %}
        {% setvar image.user|get_valid_usersubscription as image_user_valid_usersubscription %}
        {% setvar request.user|get_valid_usersubscription as request_user_valid_usersubscription %}

        {% if request_user_valid_usersubscription|allow_full_retailer_integration:image_user_valid_usersubscription %}
            {% if item_listings|length or brand_listings|length %}
                <p class="alert alert-info">
                    <i class="icon-heart" style="color:red"></i>
                    {% blocktrans trimmed %}
                        Please support AstroBin by shopping at one of our partners!
                    {% endblocktrans %}
                </p>

                <div class="equipment-listings row-fluid">
                    {% if item_listings|length %}
                        {% for listing in item_listings %}
                            <div class="span6">
                                <div class="equipment-listing">
                                    <a class="close" data-toggle="modal" title="{% trans "Disable retailer integration" %}"
                                            {% if request_user_valid_usersubscription|can_remove_retailer_integration %}
                                       href="#remove-ads-modal"
                                            {% else %}
                                       href="#feature-restricted-modal"
                                            {% endif %}
                                    >
                                        &times;
                                    </a>

                                    {% equipment_item_listing_url_with_tags listing 'card' as url_with_tags %}

                                    {% if request_user_valid_usersubscription|allow_full_retailer_integration:image_user_valid_usersubscription and listing.retailer.logo %}
                                        <a href="{{ url_with_tags }}"
                                           onclick="getOutboundLink('{{ url_with_tags }}', '{{ request.path }}')"
                                           target="_blank">
                                            <img class="logo" src="{{ listing.retailer.logo.url }}"
                                                 alt="{{ listing.retailer }}">
                                        </a>
                                    {% endif %}

                                    <a href="{{ url_with_tags }}"
                                       onclick="getOutboundLink('{{ url_with_tags }}', '{{ request.path }}')"
                                       target="_blank" class="shop-button btn btn-block">
                                        <i class="icon-shopping-cart"></i>
                                        {% blocktrans trimmed with name=listing.name retailer=listing.retailer %}
                                            Shop <strong>{{ name }}</strong> at {{ retailer }}
                                        {% endblocktrans %}
                                    </a>
                                </div>
                            </div>
                        {% endfor %}
                    {% endif %}

                    {% if brand_listings|length %}
                        {% for listing in brand_listings %}
                            <div class="span6">
                                <div class="equipment-listing">
                                    <a class="close" data-toggle="modal" title="{% trans "Disable retailer integration" %}"
                                            {% if request_user_valid_usersubscription|can_remove_retailer_integration %}
                                       href="#remove-ads-modal"
                                            {% else %}
                                       href="#feature-restricted-modal"
                                            {% endif %}
                                    >
                                        &times;
                                    </a>

                                    {% equipment_brand_listing_url_with_tags listing 'card' as url_with_tags %}

                                    {% if request_user_valid_usersubscription|allow_full_retailer_integration:image_user_valid_usersubscription and listing.retailer.logo %}
                                        <a href="{{ url_with_tags }}"
                                           onclick="getOutboundLink('{{ url_with_tags }}', '{{ request.path }}')"
                                           target="_blank">
                                            <img class="logo" src="{{ listing.retailer.logo.url }}"
                                                 alt="{{ listing.retailer }}">
                                        </a>
                                    {% endif %}

                                    <a href="{{ url_with_tags }}"
                                       onclick="getOutboundLink('{{ url_with_tags }}', '{{ request.path }}')"
                                       target="_blank" class="shop-button btn btn-block">
                                        <i class="icon-shopping-cart"></i>
                                        {% blocktrans trimmed with name=listing.brand retailer=listing.retailer %}
                                            Shop <strong>{{ name }}</strong> at {{ retailer }}
                                        {% endblocktrans %}
                                    </a>
                                </div>
                            </div>
                        {% endfor %}
                    {% endif %}
                </div>
            {% endif %}
        {% endif %}
    {% endwith %}

    <div class="footer">
        {% add_remove_toggleproperty 'follow' item request.user %}
    </div>
</div>
