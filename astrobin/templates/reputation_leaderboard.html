{% extends 'base.html' %}

{% load i18n %}
{% load django_bootstrap_breadcrumbs %}
{% load common_tags %}
{% load tags %}
{% load cache %}
{% load el_pagination_tags %}


{% block title %}{% trans "Reputation leaderboard" %} {% trans "(beta)" %}{% endblock %}

{% block breadcrumbs %}
    {{ block.super }}
    {% breadcrumb_safe 'Explore' None %}
    {% breadcrumb 'Reputation leaderboard (beta)' None %}
{% endblock %}

{% block content %}
    <div id="reputation-leaderboard-page">
        <div class="subtitle">
            <i class="icon icon-info-sign"></i>
            {% blocktrans trimmed with '<a class="btn btn-primary btn-mini" href="https://welcome.astrobin.com/features/reputation" target="_blank">' as _0 and '</a>' as _1 %}
                The <strong>Reputation Score (beta)</strong> is point based system to reward informative, constructive, and
                valuable commentary on AstroBin. {{_0}}Learn more.{{_1}}
            {% endblocktrans %}
        </div>

        <form id="reputation-leaderboard-search" class="form form-horizontal" method="get"
              action="{% url 'reputation_leaderboard' %}">
            <input type="text" id="reputation-leaderboard-search-input" name="q"
                   placeholder="{% trans "Search" %}"
                   value="{% if 'q' in request.GET %}{{ request.GET.q }}{% endif %}"/>
            <input type="hidden" name="sort" value="{% if 'sort' in request.GET %}{{ request.GET.sort }}{% endif %}" />
        </form>

        {% lazy_paginate 100 user_list using "page" %}
        {% get_pages %}

        <table class="reputation-leaderboard table striped">
            <colgroup class="hidden-phone">
                <col span="2">
                <col span="3" class="comments">
                <col span="2" class="forum-posts">
                <col span="1">
            </colgroup>
            <thead>
                <tr>
                    <th class="reputation-leaderboard-position"></th>
                    <th class="reputation-leaderboard-user"></th>

                    <th class="reputation-leaderboard-comment-likes hidden-phone" colspan="3">
                        {% trans "Comments" %}
                    </th>

                    <th class="reputation-leaderboard-forum-post-likes hidden-phone" colspan="2">
                        {% trans "Forum posts" %}
                    </th>

                    <th class="reputation-leaderboard-reputation"></th>
                </tr>
                <tr>
                    <th class="reputation-leaderboard-position">#</th>
                    <th class="reputation-leaderboard-user">{% trans "User" %}</th>

                    <!-- comments -->

                    <th class="reputation-leaderboard-written hidden-phone">
                        <a href="{% url 'reputation_leaderboard' %}{% query_string "sort='-comments_written'" "" %}">
                            {% trans "Written" %} <i class="icon-sort"></i>
                        </a>
                    </th>

                    <th class="reputation-leaderboard-received hidden-phone">
                        <a href="{% url 'reputation_leaderboard' %}{% query_string "sort='-comments'" "" %}">
                            {% trans "Received" %} <i class="icon-sort"></i>
                        </a>
                    </th>

                    <th class="reputation-leaderboard-likes-received hidden-phone">
                        <a href="{% url 'reputation_leaderboard' %}{% query_string "sort='-comment_likes_received'" "" %}">
                            {% trans "Likes" %} <i class="icon-sort"></i>
                        </a>
                    </th>

                    <!-- forum posts -->

                    <th class="reputation-leaderboard-written hidden-phone">
                        <a href="{% url 'reputation_leaderboard' %}{% query_string "sort='-forum_posts'" "" %}">
                            {% trans "Written" %} <i class="icon-sort"></i>
                        </a>
                    </th>

                    <th class="reputation-leaderboard-likes-received hidden-phone">
                        <a href="{% url 'reputation_leaderboard' %}{% query_string "sort='-forum_post_likes_received'" "" %}">
                            {% trans "Likes" %} <i class="icon-sort"></i>
                        </a>
                    </th>

                    <!-- reputation -->

                    <th class="reputation-leaderboard-reputation">
                        <a href="{% url 'reputation_leaderboard' %}{% query_string "sort='-reputation'" "" %}">
                            {% trans "Reputation" %} {% trans "(beta)" %} <i class="icon-sort"></i>
                        </a>
                    </th>
                </tr>
            </thead>

            {% for u in user_list %}
                <tr>
                    <td class="reputation-leaderboard-position">
                        {% page_counter forloop.counter pages.current.number 100 %}
                    </td>

                    <td class="reputation-leaderboard-user">
                        <a href="{% url 'user_page' u.username %}">
                            {% if u.object %}
                                {{u.object.userprofile}}
                            {% else %}
                                {{u.username}}
                            {% endif %}
                        </a>
                    </td>

                    <!-- comments -->

                    <td class="reputation-leaderboard-comments-written hidden-phone">
                        {{ u.comments_written }}
                    </td>

                    <td class="reputation-leaderboard-comments-received hidden-phone">
                        {{ u.comments }}
                    </td>

                    <td class="reputation-leaderboard-comment-likes-received hidden-phone">
                        {{ u.comment_likes_received }}
                    </td>

                    <!-- forum posts -->

                    <td class="reputation-leaderboard-forum-posts hidden-phone">
                        {{ u.forum_posts }}
                    </td>

                    <td class="reputation-leaderboard-forum-post-likes-received hidden-phone">
                        {{ u.forum_post_likes_received }}
                    </td>

                    <!-- reputation -->

                    <td class="reputation-leaderboard-reputation">
                        {{ u.reputation|floatformat:2 }}
                    </td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="9">
                        {% trans "There isn't enough data yet, please come back later!" %}
                    </td>
                </tr>
            {% endfor %}
        </table>

        <div class="pagination pagination-centered">
            {% show_pages %}
        </div>
    </div>
{% endblock %}
