<span class="toggleproperty-add-remove property-{{ property_type }}">
    <button class="{{ btn_class }}{% if is_toggled %} active{% endif %}"
            data-toggle="button"
            id="toggleproperty-{{ property_type }}-{{ content_type_id }}-{{ object_id }}"

            {% if not disabled and property_tooltip_on and property_tooltip_off %}
                rel="tooltip"
                title="{% if is_toggled %}{{ property_tooltip_on | safe }}{% else %}{{ property_tooltip_off | safe }}{% endif %}"
            {% endif %}

            {% if disabled %}
                disabled="disabled"
            {% endif %}
    >

        {% if property_icon and not hide_icon %}
            <i class="{{ property_icon }}"></i>
        {% endif %}

        {% if not hide_label %}
            {% if property_label_on or property_label_off %}
                <span class="toggleproperties-label">
                    {% if is_toggled %}
                        {{ property_label_on | safe }}
                    {% else %}
                        {{ property_label_off | safe }}
                    {% endif %}
                </span>
            {% endif %}
        {% endif %}

        {% if show_count %}
            <span id="count-{{ property_type }}-{{ content_type_id }}-{{ object_id }}"
                  class="badge badge-important">
                {{ count }}
            </span>
        {% endif %}
    </button>
</span>

<script type="text/javascript">
    $(document).ready(function () {
        $("#toggleproperty-{{ property_type }}-{{ content_type_id }}-{{ object_id }}").click(function () {
            const $btn = $(this);

            {% if request.user and request.user.is_authenticated %}
                $("#toggleproperty-{{ property_type }}-{{ content_type_id }}-{{ object_id }} .toggleproperties-label").text("...");
                if ($btn.hasClass("active")) {
                    $.ajax({
                        url: "{% url 'toggleproperty_ajax_remove' %}",
                        type: "POST",
                        data: {
                            property_type: "{{ property_type }}",
                            content_type_id: {{ content_type_id }},
                            object_id: {{ object_id }}
                        },
                        timeout: 10000,
                        dataType: 'json',
                        success: function (data) {
                            {% if property_tooltip_on and property_tooltip_off %}
                                $("#toggleproperty-{{ property_type }}-{{ content_type_id }}-{{ object_id }}")
                                    .tooltip('hide')
                                    .attr('data-original-title', "{{ property_tooltip_off | safe }}")
                                    .tooltip('fixTitle')
                                    .tooltip('show');
                            {% endif %}
                            $("#toggleproperty-{{ property_type }}-{{ content_type_id }}-{{ object_id }} .toggleproperties-label").text("{{ property_label_off | safe }}");
                            $btn.removeClass("active");
                            if (data['count'] !== undefined)
                                $('#count-{{ property_type }}-{{ content_type_id }}-{{ object_id }}').text(data.count);
                        }
                    });
                } else {
                    $.ajax({
                        url: "{% url 'toggleproperty_ajax_add' %}",
                        type: "POST",
                        data: {
                            property_type: "{{ property_type }}",
                            content_type_id: {{ content_type_id }},
                            object_id: {{ object_id }}
                        },
                        timeout: 10000,
                        dataType: 'json',
                        success: function (data) {
                            {% if property_tooltip_on and property_tooltip_off %}
                                $("#toggleproperty-{{ property_type }}-{{ content_type_id }}-{{ object_id }}")
                                    .tooltip('hide')
                                    .attr('data-original-title', "{{ property_tooltip_on | safe }}")
                                    .tooltip('fixTitle')
                                    .tooltip('show');
                            {% endif %}
                            $("#toggleproperty-{{ property_type }}-{{ content_type_id }}-{{ object_id }} .toggleproperties-label").text("{{ property_label_on | safe }}");
                            $btn.addClass("active");
                            if (data['count'] !== undefined)
                                $('#count-{{ property_type }}-{{ content_type_id }}-{{ object_id }}').text(data.count);
                        },
                        error: function() {
                            {% if property_tooltip_on and property_tooltip_off %}
                                $("#toggleproperty-{{ property_type }}-{{ content_type_id }}-{{ object_id }}")
                                    .tooltip('hide')
                                    .attr('data-original-title', "{{ property_tooltip_off | safe }}")
                                    .tooltip('fixTitle')
                                    .tooltip('show');
                            {% endif %}
                            $("#toggleproperty-{{ property_type }}-{{ content_type_id }}-{{ object_id }} .toggleproperties-label").text("{{ property_label_off | safe }}");
                        }
                    });
                }
            {% else %} {# Anonymous user #}
                window.location = '/accounts/login/?next={{request.path}}'
            {% endif %}
        });
    });
</script>

